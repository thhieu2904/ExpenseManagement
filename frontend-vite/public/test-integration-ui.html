<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test - Spending Reminder Integration</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        margin: 0;
        padding: 20px;
        background: #f5f7fa;
      }
      .test-container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .test-section {
        margin-bottom: 30px;
        padding: 20px;
        border: 1px solid #e1e8ed;
        border-radius: 8px;
        background: #fafbfc;
      }
      .test-button {
        background: #3f51b5;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        margin: 5px;
        font-size: 14px;
      }
      .test-button:hover {
        background: #303f9f;
      }
      .test-result {
        margin-top: 10px;
        padding: 10px;
        border-radius: 4px;
        font-family: monospace;
        font-size: 12px;
      }
      .success {
        background: #d1fae5;
        color: #065f46;
        border: 1px solid #10b981;
      }
      .error {
        background: #fee2e2;
        color: #991b1b;
        border: 1px solid #ef4444;
      }
      .info {
        background: #dbeafe;
        color: #1e40af;
        border: 1px solid #3b82f6;
      }
      .notification-mock {
        display: flex;
        align-items: center;
        padding: 10px;
        background: white;
        border: 1px solid #e1e8ed;
        border-radius: 8px;
        margin: 5px 0;
      }
      .notification-icon {
        width: 24px;
        height: 24px;
        background: #3f51b5;
        border-radius: 50%;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 10px;
        position: relative;
      }
      .notification-badge {
        position: absolute;
        top: -5px;
        right: -5px;
        background: #ef4444;
        color: white;
        border-radius: 50%;
        width: 18px;
        height: 18px;
        font-size: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .code-block {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 4px;
        padding: 15px;
        font-family: monospace;
        font-size: 12px;
        overflow-x: auto;
        margin: 10px 0;
      }
    </style>
  </head>
  <body>
    <div class="test-container">
      <h1>üß™ Test Spending Reminder Integration</h1>
      <p>Test t√≠ch h·ª£p gi·ªØa Spending Reminder v√† Header Notifications</p>

      <!-- Test 1: Basic Integration -->
      <div class="test-section">
        <h3>üîó Test 1: Basic Integration</h3>
        <p>
          Ki·ªÉm tra xem spending notifications c√≥ xu·∫•t hi·ªán trong header kh√¥ng
        </p>

        <div class="notification-mock">
          <div class="notification-icon">
            üîî
            <span class="notification-badge" id="mock-badge">3</span>
          </div>
          <span>Mock Header Notification (should include spending alerts)</span>
        </div>

        <button class="test-button" onclick="testBasicIntegration()">
          Run Test
        </button>
        <div id="test1-result" class="test-result"></div>
      </div>

      <!-- Test 2: Settings Change Impact -->
      <div class="test-section">
        <h3>‚öôÔ∏è Test 2: Settings Change Impact</h3>
        <p>
          Ki·ªÉm tra xem thay ƒë·ªïi settings c√≥ ·∫£nh h∆∞·ªüng ƒë·∫øn notification count
          kh√¥ng
        </p>

        <div style="display: flex; gap: 10px; margin-bottom: 10px">
          <input
            type="number"
            id="daily-limit"
            placeholder="Daily Limit"
            value="200000"
            style="padding: 8px; border: 1px solid #ccc; border-radius: 4px"
          />
          <input
            type="number"
            id="threshold"
            placeholder="Threshold %"
            value="80"
            style="padding: 8px; border: 1px solid #ccc; border-radius: 4px"
          />
        </div>

        <button class="test-button" onclick="testSettingsChange()">
          Change Settings & Test
        </button>
        <div id="test2-result" class="test-result"></div>
      </div>

      <!-- Test 3: Notification Types -->
      <div class="test-section">
        <h3>üìã Test 3: Notification Types</h3>
        <p>Ki·ªÉm tra c√°c lo·∫°i notification spending c√≥ ƒë∆∞·ª£c t·∫°o ra ƒë√∫ng kh√¥ng</p>

        <button class="test-button" onclick="testNotificationTypes()">
          Test Notification Types
        </button>
        <div id="test3-result" class="test-result"></div>

        <div id="notification-list" style="margin-top: 10px"></div>
      </div>

      <!-- Test 4: Real-time Updates -->
      <div class="test-section">
        <h3>‚ö° Test 4: Real-time Updates</h3>
        <p>Ki·ªÉm tra t√≠nh nƒÉng c·∫≠p nh·∫≠t th√¥ng b√°o real-time (m·ªói 5 ph√∫t)</p>

        <button class="test-button" onclick="testRealTimeUpdates()">
          Start Real-time Test
        </button>
        <button class="test-button" onclick="stopRealTimeTest()">
          Stop Test
        </button>
        <div id="test4-result" class="test-result"></div>
      </div>

      <!-- Instructions -->
      <div class="test-section">
        <h3>üìù Instructions</h3>
        <p>ƒê·ªÉ test ƒë·∫ßy ƒë·ªß, h√£y:</p>
        <ol>
          <li>M·ªü Developer Console (F12)</li>
          <li>Ch·∫°y t·ª´ng test b·∫±ng c√°c n√∫t above</li>
          <li>Ki·ªÉm tra console output ƒë·ªÉ xem chi ti·∫øt</li>
          <li>Verify notification badge tr√™n header th·ª±c t·∫ø</li>
          <li>Click v√†o notification icon ƒë·ªÉ xem dropdown</li>
        </ol>

        <div class="code-block">
          // Ch·∫°y test t·ªïng h·ª£p trong console:
          window.testSpendingIntegration.runIntegrationTests(); // Ho·∫∑c test
          t·ª´ng ph·∫ßn:
          window.testSpendingIntegration.testHeaderNotificationDisplay();
        </div>
      </div>
    </div>

    <script>
      let realTimeInterval = null;

      async function testBasicIntegration() {
        const resultDiv = document.getElementById("test1-result");
        resultDiv.className = "test-result info";
        resultDiv.innerHTML = "Testing basic integration...";

        try {
          // Test if services are available
          const response = await fetch("/src/api/notificationService.js");
          if (response.ok) {
            resultDiv.className = "test-result success";
            resultDiv.innerHTML =
              "‚úÖ Notification service accessible<br>üí° Check browser console for detailed integration test results";

            // Try to run integration test
            if (window.testSpendingIntegration) {
              window.testSpendingIntegration.testSpendingNotificationIntegration();
            } else {
              console.log("Loading integration test script...");
              const script = document.createElement("script");
              script.src = "/test-spending-integration.js";
              document.head.appendChild(script);
            }
          } else {
            throw new Error("Service not accessible");
          }
        } catch (error) {
          resultDiv.className = "test-result error";
          resultDiv.innerHTML = `‚ùå Integration test failed: ${error.message}<br>üí° Make sure the app is running`;
        }
      }

      function testSettingsChange() {
        const resultDiv = document.getElementById("test2-result");
        const dailyLimit = document.getElementById("daily-limit").value;
        const threshold = document.getElementById("threshold").value;

        resultDiv.className = "test-result info";
        resultDiv.innerHTML = "Changing settings...";

        try {
          const newSettings = {
            enabled: true,
            dailyLimit: parseInt(dailyLimit),
            monthlyLimit: 5000000,
            reminderTime: "09:00",
            notificationThreshold: parseInt(threshold),
            includeGoals: true,
            includeSources: true,
          };

          localStorage.setItem(
            "spendingReminderSettings",
            JSON.stringify(newSettings)
          );

          resultDiv.className = "test-result success";
          resultDiv.innerHTML = `‚úÖ Settings updated:<br>Daily Limit: ${dailyLimit.toLocaleString()}‚Ç´<br>Threshold: ${threshold}%<br>üí° Check header notification count for changes`;

          // Update mock badge
          const mockBadge = document.getElementById("mock-badge");
          const newCount = Math.floor(Math.random() * 9) + 1;
          mockBadge.textContent = newCount;
        } catch (error) {
          resultDiv.className = "test-result error";
          resultDiv.innerHTML = `‚ùå Settings change failed: ${error.message}`;
        }
      }

      async function testNotificationTypes() {
        const resultDiv = document.getElementById("test3-result");
        const listDiv = document.getElementById("notification-list");

        resultDiv.className = "test-result info";
        resultDiv.innerHTML = "Testing notification types...";

        try {
          // Mock different notification types
          const mockNotifications = [
            {
              id: "daily_spending_test",
              type: "spending_limit",
              title: "C·∫£nh b√°o chi ti√™u h√†ng ng√†y",
              message: "B·∫°n ƒë√£ chi ti√™u 85% ng∆∞·ª°ng h√†ng ng√†y",
              priority: "medium",
              icon: "üí∞",
            },
            {
              id: "monthly_spending_test",
              type: "spending_limit",
              title: "C·∫£nh b√°o chi ti√™u h√†ng th√°ng",
              message: "B·∫°n ƒë√£ chi ti√™u 105% ng∆∞·ª°ng h√†ng th√°ng",
              priority: "high",
              icon: "üí∞",
            },
            {
              id: "goal_deadline_test",
              type: "goal_deadline",
              title: "M·ª•c ti√™u s·∫Øp h·∫øt h·∫°n",
              message: 'M·ª•c ti√™u "Du l·ªãch" s·∫Ω h·∫øt h·∫°n trong 3 ng√†y',
              priority: "medium",
              icon: "‚è∞",
            },
          ];

          let notificationHtml = "<h4>Mock Notifications:</h4>";
          mockNotifications.forEach((notif) => {
            const priorityClass =
              notif.priority === "high"
                ? "error"
                : notif.priority === "medium"
                  ? "info"
                  : "success";

            notificationHtml += `
                        <div class="test-result ${priorityClass}" style="margin: 5px 0;">
                            ${notif.icon} <strong>${notif.title}</strong><br>
                            ${notif.message}<br>
                            <small>Type: ${notif.type} | Priority: ${notif.priority}</small>
                        </div>
                    `;
          });

          listDiv.innerHTML = notificationHtml;

          resultDiv.className = "test-result success";
          resultDiv.innerHTML =
            "‚úÖ Notification types generated successfully<br>üí° These should appear in header dropdown when real data triggers them";
        } catch (error) {
          resultDiv.className = "test-result error";
          resultDiv.innerHTML = `‚ùå Notification type test failed: ${error.message}`;
        }
      }

      function testRealTimeUpdates() {
        const resultDiv = document.getElementById("test4-result");

        resultDiv.className = "test-result info";
        resultDiv.innerHTML =
          "Starting real-time update test... (checks every 10 seconds)";

        let updateCount = 0;
        realTimeInterval = setInterval(() => {
          updateCount++;
          const mockBadge = document.getElementById("mock-badge");
          const newCount = Math.floor(Math.random() * 9) + 1;
          mockBadge.textContent = newCount;

          resultDiv.innerHTML = `üîÑ Real-time test running... Update #${updateCount}<br>Mock badge count: ${newCount}<br>üí° In real app, this would update every 5 minutes via useNotifications hook`;

          if (updateCount >= 6) {
            // Stop after 1 minute
            stopRealTimeTest();
          }
        }, 10000);
      }

      function stopRealTimeTest() {
        const resultDiv = document.getElementById("test4-result");

        if (realTimeInterval) {
          clearInterval(realTimeInterval);
          realTimeInterval = null;

          resultDiv.className = "test-result success";
          resultDiv.innerHTML =
            "‚úÖ Real-time test stopped<br>üí° In the actual app, notifications auto-refresh every 5 minutes";
        }
      }

      // Load integration test script
      window.addEventListener("load", () => {
        const script = document.createElement("script");
        script.src = "/test-spending-integration.js";
        document.head.appendChild(script);
      });
    </script>
  </body>
</html>
