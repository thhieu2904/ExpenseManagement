<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Spending Notifications</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: #f5f5f5;
      }
      .container {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .section {
        margin-bottom: 30px;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 6px;
        border-left: 4px solid #007bff;
      }
      button {
        background: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #0056b3;
      }
      .success {
        background: #d4edda;
        border-color: #28a745;
      }
      .error {
        background: #f8d7da;
        border-color: #dc3545;
      }
      .info {
        background: #d1ecf1;
        border-color: #17a2b8;
      }
      pre {
        background: #1e1e1e;
        color: #f8f8f2;
        padding: 10px;
        border-radius: 4px;
        overflow-x: auto;
        font-size: 12px;
      }
      .notification-item {
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 6px;
        padding: 12px;
        margin: 8px 0;
        border-left: 4px solid #ffc107;
      }
      .notification-item.high {
        border-left-color: #dc3545;
      }
      .notification-item.medium {
        border-left-color: #ffc107;
      }
      .notification-item.low {
        border-left-color: #28a745;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üß™ Test Spending Notifications System</h1>

      <div class="section">
        <h3>üìã Current Settings</h3>
        <div id="settings-display">Loading...</div>
        <button onclick="refreshSettings()">Refresh Settings</button>
      </div>

      <div class="section">
        <h3>üîß Test Mode Controls</h3>
        <button onclick="enableTestMode()">Enable Test Mode</button>
        <button onclick="disableTestMode()">Disable Test Mode</button>
        <button onclick="checkTestMode()">Check Test Mode Status</button>
        <div id="test-mode-status"></div>
      </div>

      <div class="section">
        <h3>üìä Spending Data</h3>
        <button onclick="checkSpendingData()">
          Check Daily/Monthly Spending
        </button>
        <div id="spending-data"></div>
      </div>

      <div class="section">
        <h3>üîî Notifications</h3>
        <button onclick="loadNotifications()">Load Notifications</button>
        <button onclick="generateTestData()">
          Generate Test Spending Data
        </button>
        <div id="notifications-display"></div>
      </div>

      <div class="section">
        <h3>üõ†Ô∏è Debug Tools</h3>
        <button onclick="clearAllData()">Clear All Data</button>
        <button onclick="exportDebugInfo()">Export Debug Info</button>
      </div>
    </div>

    <script>
      // Helper functions
      function log(message, type = "info") {
        console.log(message);
        const status = document.createElement("div");
        status.className = `section ${type}`;
        status.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong>: ${message}`;
        document.body.appendChild(status);
      }

      // Settings functions
      function refreshSettings() {
        const settings = JSON.parse(
          localStorage.getItem("spendingReminderSettings") || "{}"
        );
        const enabled = localStorage.getItem("spendingReminderEnabled");

        document.getElementById("settings-display").innerHTML = `
                <pre>${JSON.stringify(
                  {
                    enabled: JSON.parse(enabled || "false"),
                    ...settings,
                  },
                  null,
                  2
                )}</pre>
            `;
      }

      // Test mode functions
      function enableTestMode() {
        localStorage.setItem("notificationTestMode", "true");

        const testNotifications = [
          {
            id: `test_spending_daily_${Date.now()}`,
            type: "spending_limit",
            title: "C·∫£nh b√°o chi ti√™u h√†ng ng√†y",
            message: "B·∫°n ƒë√£ chi ti√™u 85% ng∆∞·ª°ng h√†ng ng√†y (170,000‚Ç´/200,000‚Ç´)",
            priority: "medium",
            createdAt: new Date(),
          },
          {
            id: `test_spending_monthly_${Date.now() + 1}`,
            type: "spending_limit",
            title: "C·∫£nh b√°o chi ti√™u h√†ng th√°ng",
            message:
              "B·∫°n ƒë√£ chi ti√™u 95% ng∆∞·ª°ng h√†ng th√°ng (4,750,000‚Ç´/5,000,000‚Ç´)",
            priority: "high",
            createdAt: new Date(Date.now() - 30 * 60 * 1000),
          },
        ];

        localStorage.setItem(
          "testNotifications",
          JSON.stringify(testNotifications)
        );
        log("Test mode enabled with sample notifications", "success");
        checkTestMode();
      }

      function disableTestMode() {
        localStorage.removeItem("notificationTestMode");
        localStorage.removeItem("testNotifications");
        log("Test mode disabled", "info");
        checkTestMode();
      }

      function checkTestMode() {
        const testMode =
          localStorage.getItem("notificationTestMode") === "true";
        const testNotifications = JSON.parse(
          localStorage.getItem("testNotifications") || "[]"
        );

        document.getElementById("test-mode-status").innerHTML = `
                <div class="section ${testMode ? "success" : "info"}">
                    <strong>Test Mode:</strong> ${testMode ? "ENABLED" : "DISABLED"}<br>
                    <strong>Test Notifications:</strong> ${testNotifications.length} items
                </div>
            `;
      }

      // Spending data functions
      async function checkSpendingData() {
        try {
          // Since we can't import modules in this context, we'll simulate the check
          log(
            "Checking spending data... (would need app context for real data)",
            "info"
          );

          document.getElementById("spending-data").innerHTML = `
                    <div class="section info">
                        <p><strong>Note:</strong> Real spending data requires app context.</p>
                        <p>To test with real data:</p>
                        <ol>
                            <li>Open app in browser</li>
                            <li>Open browser console</li>
                            <li>Run: <code>debugSpendingNotifications()</code></li>
                        </ol>
                    </div>
                `;
        } catch (error) {
          log("Error checking spending data: " + error.message, "error");
        }
      }

      // Notification functions
      async function loadNotifications() {
        try {
          const testMode =
            localStorage.getItem("notificationTestMode") === "true";

          if (testMode) {
            const testNotifications = JSON.parse(
              localStorage.getItem("testNotifications") || "[]"
            );
            displayNotifications(testNotifications);
            log(
              `Loaded ${testNotifications.length} test notifications`,
              "success"
            );
          } else {
            log(
              "Real notifications require app context. Enable test mode to see demo notifications.",
              "info"
            );
            displayNotifications([]);
          }
        } catch (error) {
          log("Error loading notifications: " + error.message, "error");
        }
      }

      function displayNotifications(notifications) {
        const container = document.getElementById("notifications-display");

        if (notifications.length === 0) {
          container.innerHTML =
            '<div class="section info">No notifications found</div>';
          return;
        }

        const html = notifications
          .map(
            (notification) => `
                <div class="notification-item ${notification.priority}">
                    <div><strong>${notification.title}</strong></div>
                    <div>${notification.message}</div>
                    <div style="font-size: 0.8em; color: #666; margin-top: 5px;">
                        Type: ${notification.type} | Priority: ${notification.priority} | 
                        Time: ${new Date(notification.createdAt).toLocaleString()}
                    </div>
                </div>
            `
          )
          .join("");

        container.innerHTML = html;
      }

      function generateTestData() {
        // Create fake spending that exceeds limits
        const fakeTransactions = [
          {
            amount: 150000,
            description: "Test transaction 1",
            date: new Date().toISOString(),
          },
          {
            amount: 100000,
            description: "Test transaction 2",
            date: new Date().toISOString(),
          },
          {
            amount: 75000,
            description: "Test transaction 3",
            date: new Date().toISOString(),
          },
        ];

        localStorage.setItem(
          "testSpendingData",
          JSON.stringify(fakeTransactions)
        );
        log("Generated test spending data (total: 325,000‚Ç´)", "success");
      }

      // Utility functions
      function clearAllData() {
        const keys = [
          "spendingReminderSettings",
          "spendingReminderEnabled",
          "notificationTestMode",
          "testNotifications",
          "testSpendingData",
        ];

        keys.forEach((key) => localStorage.removeItem(key));
        log("Cleared all test data", "success");

        refreshSettings();
        checkTestMode();
        document.getElementById("notifications-display").innerHTML = "";
        document.getElementById("spending-data").innerHTML = "";
      }

      function exportDebugInfo() {
        const debugInfo = {
          timestamp: new Date().toISOString(),
          localStorage: {},
          userAgent: navigator.userAgent,
          url: window.location.href,
        };

        // Export relevant localStorage items
        const keys = [
          "spendingReminderSettings",
          "spendingReminderEnabled",
          "notificationTestMode",
          "testNotifications",
          "testSpendingData",
        ];

        keys.forEach((key) => {
          const value = localStorage.getItem(key);
          if (value) {
            try {
              debugInfo.localStorage[key] = JSON.parse(value);
            } catch {
              debugInfo.localStorage[key] = value;
            }
          }
        });

        const blob = new Blob([JSON.stringify(debugInfo, null, 2)], {
          type: "application/json",
        });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `spending-debug-${new Date().toISOString().split("T")[0]}.json`;
        a.click();
        URL.revokeObjectURL(url);

        log("Debug info exported", "success");
      }

      // Initialize
      document.addEventListener("DOMContentLoaded", function () {
        refreshSettings();
        checkTestMode();
        log("Test page loaded", "success");
      });
    </script>
  </body>
</html>
